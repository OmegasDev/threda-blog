---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout 
  title="Create Hub - Threda"
  description="Create your own news hub and build a community around topics you're passionate about."
>
  <Header />
  
  <main class="min-h-screen bg-slate-50 dark:bg-slate-900">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-4">
          Create Your Hub
        </h1>
        <p class="text-slate-600 dark:text-slate-400">
          Start your own community and share news about topics you're passionate about.
        </p>
      </div>

      <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 border border-slate-200 dark:border-slate-700">
        <form id="create-hub-form" class="space-y-6">
          <!-- Hub Name -->
          <div>
            <label for="name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Hub Name *
            </label>
            <input 
              type="text" 
              id="name" 
              name="name"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-700 dark:text-white"
              placeholder="e.g., AI Innovations, Crypto Trading Hub"
              required
            />
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
              Choose a descriptive name for your hub
            </p>
          </div>

          <!-- Hub Slug -->
          <div>
            <label for="slug" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Hub URL *
            </label>
            <div class="flex items-center">
              <span class="text-slate-500 dark:text-slate-400 text-sm mr-2">threda.com/hub/</span>
              <input 
                type="text" 
                id="slug" 
                name="slug"
                class="flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-700 dark:text-white"
                placeholder="ai-innovations"
                pattern="[a-z0-9-]+"
                required
              />
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
              Only lowercase letters, numbers, and hyphens allowed
            </p>
          </div>

          <!-- Description -->
          <div>
            <label for="description" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Description *
            </label>
            <textarea 
              id="description" 
              name="description" 
              rows="3"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-700 dark:text-white"
              placeholder="Describe what your hub is about and what kind of content you'll share..."
              required
            ></textarea>
          </div>

          <!-- Category -->
          <div>
            <label for="category" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Category *
            </label>
            <select 
              id="category" 
              name="category"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-700 dark:text-white"
              required
            >
              <option value="">Select a category</option>
              <option value="Tech">Technology</option>
              <option value="Crypto">Cryptocurrency</option>
              <option value="Finance">Finance</option>
              <option value="Politics">Politics</option>
              <option value="Business">Business</option>
              <option value="Sports">Sports</option>
              <option value="Health">Health</option>
              <option value="Science">Science</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Lifestyle">Lifestyle</option>
            </select>
          </div>

          <!-- Profile Image -->
          <div>
            <label for="profile_image" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Profile Image URL
            </label>
            <input 
              type="url" 
              id="profile_image" 
              name="profile_image"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-700 dark:text-white"
              placeholder="https://example.com/image.jpg"
            />
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
              Optional: Add a profile image for your hub
            </p>
          </div>

          <!-- Banner Image -->
          <div>
            <label for="banner_image" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Banner Image URL
            </label>
            <input 
              type="url" 
              id="banner_image" 
              name="banner_image"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-slate-700 dark:text-white"
              placeholder="https://example.com/banner.jpg"
            />
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
              Optional: Add a banner image for your hub
            </p>
          </div>

          <!-- Privacy Setting -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">
              Privacy Setting
            </label>
            <div class="space-y-3">
              <label class="flex items-center">
                <input 
                  type="radio" 
                  name="is_public" 
                  value="true" 
                  checked
                  class="w-4 h-4 text-primary-600 border-slate-300 focus:ring-primary-500"
                />
                <span class="ml-3">
                  <span class="font-medium text-slate-900 dark:text-white">Public</span>
                  <span class="block text-sm text-slate-500 dark:text-slate-400">Anyone can discover and follow your hub</span>
                </span>
              </label>
              <label class="flex items-center">
                <input 
                  type="radio" 
                  name="is_public" 
                  value="false"
                  class="w-4 h-4 text-primary-600 border-slate-300 focus:ring-primary-500"
                />
                <span class="ml-3">
                  <span class="font-medium text-slate-900 dark:text-white">Private</span>
                  <span class="block text-sm text-slate-500 dark:text-slate-400">Only you can see and manage this hub</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="pt-4">
            <button 
              type="submit"
              class="w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200"
            >
              Create Hub
            </button>
          </div>
        </form>
      </div>

      <!-- Guidelines -->
      <div class="mt-8 bg-primary-50 dark:bg-primary-900/20 rounded-2xl p-6">
        <h3 class="font-bold text-slate-900 dark:text-white mb-3">Hub Guidelines</h3>
        <ul class="space-y-2 text-sm text-slate-600 dark:text-slate-400">
          <li>• Keep your hub focused on a specific topic or niche</li>
          <li>• Share high-quality, relevant content regularly</li>
          <li>• Engage with your community and respond to threds</li>
          <li>• Follow Threda's community guidelines and terms of service</li>
          <li>• Be respectful and maintain a positive environment</li>
        </ul>
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<script>
  import { createHub } from '../lib/auth';

  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('create-hub-form');
    const nameInput = document.getElementById('name');
    const slugInput = document.getElementById('slug');

    // Auto-generate slug from name
    nameInput?.addEventListener('input', function(e) {
      const name = e.target.value;
      const slug = name
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .trim();
      if (slugInput) {
        slugInput.value = slug;
      }
    });

    form?.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      const hubData = {
        name: formData.get('name'),
        slug: formData.get('slug'),
        description: formData.get('description'),
        category: formData.get('category'),
        profile_image: formData.get('profile_image') || null,
        banner_image: formData.get('banner_image') || null,
        is_public: formData.get('is_public') === 'true'
      };

      try {
        const { error } = await createHub(hubData);
        if (error) throw error;
        
        alert('Hub created successfully!');
        window.location.href = `/hub/${hubData.slug}`;
      } catch (error) {
        console.error('Error creating hub:', error);
        alert('Failed to create hub. Please try again.');
      }
    });
  });
</script>