---
import { format } from 'date-fns';
import type { Post } from '../lib/supabase';

export interface Props {
  post: Post;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const formattedDate = format(new Date(post.created_at), 'MMM dd, yyyy');
---

<article class={`bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden ${featured ? 'col-span-2 row-span-2' : ''}`}>
  <div class={`${featured ? 'flex flex-col h-full' : ''}`}>
    {post.featured_image && (
      <div class={`relative ${featured ? 'h-64' : 'h-48'}`}>
        <img 
          src={post.featured_image} 
          alt={post.title}
          class="w-full h-full object-cover"
          loading="lazy"
        />
        {post.category && (
          <div 
            class="absolute top-4 left-4 px-3 py-1 rounded-full text-white text-xs font-medium"
            style={`background-color: ${post.category.color}`}
          >
            {post.category.name}
          </div>
        )}
      </div>
    )}
    
    <div class={`p-6 ${featured ? 'flex-1 flex flex-col' : ''}`}>
      <div class="flex items-center text-sm text-gray-500 mb-3">
        <time datetime={post.created_at}>{formattedDate}</time>
        <span class="mx-2">â€¢</span>
        <span>{post.view_count} views</span>
        {post.trending_score > 50 && (
          <>
            <span class="mx-2">â€¢</span>
            <span class="text-red-500 font-medium">ðŸ”¥ Trending</span>
          </>
        )}
      </div>
      
      <h2 class={`font-bold text-gray-900 mb-3 line-clamp-2 hover:text-blue-600 transition-colors ${featured ? 'text-2xl' : 'text-lg'}`}>
        <a href={`/post/${post.slug}`}>{post.title}</a>
      </h2>
      
      <p class={`text-gray-600 mb-4 ${featured ? 'text-base flex-1' : 'text-sm line-clamp-3'}`}>
        {post.excerpt}
      </p>
      
      <div class="flex items-center justify-between">
        <a 
          href={`/post/${post.slug}`} 
          class="text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors inline-flex items-center"
        >
          Read more
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
        
        {post.category && !post.featured_image && (
          <span 
            class="px-2 py-1 rounded-full text-white text-xs font-medium"
            style={`background-color: ${post.category.color}`}
          >
            {post.category.name}
          </span>
        )}
      </div>
    </div>
  </div>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>